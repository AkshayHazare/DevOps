<!DOCTYPE html>
<html>
<!-- THIS FILE WAS GENERATED BY A SCRIPT: DO NOT EDIT IT! -->
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="../style.css">

        <!-- jQuery CDN -->
         <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
         <!-- Bootstrap Js CDN -->
         <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

         <script type="text/javascript">
             var status = 'on';
             $(document).ready(function () {
                 $('#sidebarCollapse').on('click', function () {
                     $('#sidebar').toggleClass('active');
                     if (status == 'on') {
                         $('#sidebarText').text("Expand Side Nav");
                         status = 'off';
                     } else {
                         $('#sidebarText').text("Collapse Side Nav");
                         status = 'on';
                     }
                 });
             });
         </script>
        <title>
            Our Deployment Implementation
        </title>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114841175-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-114841175-1');
</script>
    </head>

    <body>
        <div class="wrapper">
<!-- Sidebar Holder -->
<nav id="sidebar">
    <div id="sidebarCollapse">
        <div class="sidebar-header">
            <h1>DevOps</h1>
            <strong>DO</strong>
        </div>
    </div>

    <ul class="list-unstyled components">
        <li>
            <a href="https://gcallah.github.io/DevOps/index.html">
                <i class="glyphicon glyphicon-home"></i>
                Home
            </a>
        </li>
        <li>
            <a href="#pageSubmenu" data-toggle="collapse" aria-expanded="false">
                <i class="glyphicon glyphicon-duplicate"></i>
                Main Areas of Coverage
            </a>
            <ul class="collapse list-unstyled" id="pageSubmenu">
                <li>
                  <a href="#BuildSubmenu" data-toggle="collapse" aria-expanded="false">Build</a>
                  <ul class="collapse list-unstyled" id="BuildSubmenu">
                    <li><a href="https://gcallah.github.io/DevOps/build/links.html">Build links</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/build/theory.html">Build theory</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/build/tools.html">Build tools</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/build/implementation.html">Our build implementation</a></li>
                  </ul>
                </li>
                <li>
                  <a href="#CloudSubmenu" data-toggle="collapse" aria-expanded="false">Cloud</a>
                  <ul class="collapse list-unstyled" id="CloudSubmenu">
                    <li><a href="https://gcallah.github.io/DevOps/cloud/links.html">Cloud links</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/cloud/theory.html">Cloud theory</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/cloud/tools.html">Cloud tools</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/cloud/implementation.html">Our cloud implementation</a></li>
                  </ul>
                </li>
                <li>
                  <a href="#CodingSubmenu" data-toggle="collapse" aria-expanded="false">Coding: Lean and Agile Practices</a>
                  <ul class="collapse list-unstyled" id="CodingSubmenu">
                    <li><a href="https://gcallah.github.io/DevOps/coding/links.html">Coding links</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/coding/theory.html">Coding theory</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/coding/tools.html">Coding tools</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/coding/implementation.html">Our coding implementation</a></li>
                  </ul>
                </li>
                <li>
                  <a href="#DeploySubmenu" data-toggle="collapse" aria-expanded="false">Deployment</a>
                  <ul class="collapse list-unstyled" id="DeploySubmenu">
                    <li><a href="https://gcallah.github.io/DevOps/deployment/links.html">Deployment links</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/deployment/theory.html">Deployment theory</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/deployment/tools.html">Deployment tools</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/deployment/implementation.html">Our deployment implementation</a></li>
                  </ul>
                </li>
                <li>
                  <a href="#MonitorSubmenu" data-toggle="collapse" aria-expanded="false">Monitoring</a>
                  <ul class="collapse list-unstyled" id="MonitorSubmenu">
                    <li><a href="https://gcallah.github.io/DevOps/monitoring/links.html">Monitoring links</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/monitoring/theory.html">Monitoring theory</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/monitoring/tools.html">Monitoring tools</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/monitoring/implementation.html">Our monitoring implementation </a></li>
                  </ul>
                </li>
                <li>
                  <a href="#SecuritySubmenu" data-toggle="collapse" aria-expanded="false">Security: Rugged DevOps</a>
                  <ul class="collapse list-unstyled" id="SecuritySubmenu">
                    <li><a href="https://gcallah.github.io/DevOps/security/links.html">Security links</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/security/theory.html">Security theory</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/security/tools.html">Security tools</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/security/implementation.html">Our security implementation</a></li>
                  </ul>
                </li>
                <li>
                  <a href="#TestingSubmenu" data-toggle="collapse" aria-expanded="false">Testing</a>
                  <ul class="collapse list-unstyled" id="TestingSubmenu">
                    <li><a href="https://gcallah.github.io/DevOps/testing/links.html">Testing links</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/testing/theory.html">Testing theory</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/testing/tools.html">Testing tools</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/testing/implementation.html">Our testing implementation</a></li>
                  </ul>
                </li>
                <li>
                  <a href="#WorkflowSubmenu" data-toggle="collapse" aria-expanded="false">Workflow: DevOps as a Way of Work</a>
                  <ul class="collapse list-unstyled" id="WorkflowSubmenu">
                    <li><a href="https://gcallah.github.io/DevOps/workflow/links.html">Workflow links</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/workflow/theory.html">Workflow theory</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/workflow/tools.html">Workflow tools</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/workflow/implementation.html">Our workflow implementation</a></li>
                  </ul>
                </li>
                <li>
                  <a href="#UXSubmenu" data-toggle="collapse" aria-expanded="false">UX: User Interface</a>
                  <ul class="collapse list-unstyled" id="UXSubmenu">
                    <li><a href="https://gcallah.github.io/DevOps/UX/links.html">UX links</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/UX/theory.html">UX theory</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/UX/tools.html">UX tools</a></li>
                    <li><a href="https://gcallah.github.io/DevOps/UX/implementation.html">Our UX implementation</a></li>
                  </ul>
                </li>
            </ul>
        </li>
        <li>
            <a href="#MaterialsSubmenu" data-toggle="collapse" aria-expanded="false">
                <i class="glyphicon glyphicon-link"></i>
                Other Materials
            </a>
            <ul class="collapse list-unstyled" id="MaterialsSubmenu">
              <li>
                <a href="#CMSubmenu" data-toggle="collapse" aria-expanded="false">Course-specific Material</a>
                <ul class="collapse list-unstyled" id="CMSubmenu">
                  <li><a href="https://gcallah.github.io/DevOps/courseDescr.html">Course description, Spring 2018</a></li>
                  <li><a href="https://gcallah.github.io/DevOps/courseExpectations.html">Course expectations, Spring 2018</a></li>
                  <li><a href="https://gcallah.github.io/DevOps/TeamsTable.html">Our teams for Spring 2018</a></li>
                  <li><a href="https://gcallah.github.io/DevOps/books.html">DevOps reading list</a></li>
                  <li><a href="https://gcallah.github.io/DevOps/journals/index.html">Our DevOps journals</a></li>
                  <li>
                  <a href="http://www.thedevopscourse.com/quiz/">Our Django
                  site: we are creating a quiz system here.</a>
                  </li>
                  <li>
                    <a href="https://gcallah.pythonanywhere.com/berkeley/">
                        DevOps Bibliographic Search
                    </a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="#SupSubmenu" data-toggle="collapse" aria-expanded="false">Supplementary Material</a>
                <ul class="collapse list-unstyled" id="SupSubmenu">
                  <li><a href="https://gcallah.github.io/DevOps/websites.html">DevOps websites</a></li>
                </ul>
              </li>
            </ul>
        </li>
        <li>
            <a href="https://gcallah.github.io/DevOps/about.html">
                <i class="glyphicon glyphicon-briefcase"></i>
                About
            </a>
        </li>
    </ul>
</nav>
            <div id="content">
                <h1>
                    Our Deployment Implementation
                </h1>
                <h2> Steps to deploy the website on Amazon EC2
                    instances using puppet </h2>

                <h4> Configuration </h4>
                <p> We have used client/server architecture having one
                puppet master and one puppet agent.
                </p>
                <h4> Steps </h4>
                <ol class="nested">
                <li> KeyPair -
                    Login to Amazon AWS console. Go to Network and Security
                    and create key pairs to login into EC2 instances from
                    local machine.
                    <br>
                    <figure>
                    <img src="https://gcallah.github.io/DevOps/deployment/graphics/key_pair.png" style="width:604px;height:442px;">
                    </figure>
                </li>
                <li> Security Group -
                    Create Security Group to enable ports for http, ssh, tcp
                    and icmp. This group will be associated with the EC2
                    instances.
                    <br>
                    <figure>
                    <img src="https://gcallah.github.io/DevOps/deployment/graphics/security_group.png" style="width:604px;height:442px;">
                    </figure>

                </li>
                <li> Launch EC2 Instances -
                    Go to Instances and click on "Launch Instance". On the
                    next screen select "Red Hat Enterprise Linux" image.
                    <figure>
                    <img src="https://gcallah.github.io/DevOps/deployment/graphics/rhel.png" style="width:604px;height:442px;">
                    </figure>
                    <br>
                    Click "Configure Instance Details" and choose number of
                    instances 2 (master and agent).
                    <br>
                    <figure>
                    <img src="https://gcallah.github.io/DevOps/deployment/graphics/number_instances.png" style="width:604px;height:442px;">
                    </figure>
                    <br>
                    Go to next and on Step 6: "Configure Security Group"
                    select the security group created before and then launch
                    the instances.
                    <figure>
                    <img src="https://gcallah.github.io/DevOps/deployment/graphics/instance_security_group.png" style="width:604px;height:442px;">
                    </figure>
                </li>
                <li>
                Wait for the instance state change to running. Give names to
                instances (master, agent).
                </li>
                <li>
                Next connect to the instances using ssh following the steps
                in connect box as shown below
                    <figure>
                    <img src="https://gcallah.github.io/DevOps/deployment/graphics/connect.png" style="width:604px;height:442px;">
                    </figure>
                </li>
                </ol>
                <p> The puppet setup guide[2] was referenced for installing 
                puppet on RHEL master and agent. The steps are described below:
                </p>
                <h4> Master Configuration </h4>
                <ol class="nested">
                <li> Configure hostname for master node as:
                <br>
                [root@master ~]# hostname master.devops.org
                </li>
                <li> Add entry for agent in hosts file of master:
                <br>
                [root@master ~]# vi /etc/hosts
                <br>
                ip-address-agent agent.devops.org agent
                </li>
                <li> Puppet can be installed from the yum.puppetlabs.com
                package repository using below command:
                <br>
                [root@master ~]# yum -y install https://yum.puppetlabs.com/
                puppetlabs-release-pc1-el-7.noarch.rpm
                </li>
                <li> Install puppet master server:
                <br>
                [root@master ~]# yum -y install puppetserver
                </li>
                <li> Creating symbolic link to make puppet available on
                command line:
                <br>
                [root@master ~]# ln -s /opt/puppetlabs/bin/puppet*
                /usr/local/bin/
                </li>
                <li> Generate CA certificate and the puppet master
                certificate with the appropriate DNS names:
                <br>
                [root@master ~]# puppet master --no-daemonize --verbose
                </li>
                <li> Enable and start puppetservice on master:
                <br>
                [root@master ~]# systemctl enable puppetserver
                <br>
                [root@master ~]# systemctl start puppetserver
                </li>
                </ol>
                <h4> Agent Configuration </h4>
                <ol class="nested">
                <li> Configure hostname for agent node as:
                <br>
                [root@agent ~]# hostname agent.devops.org
                </li>
                <li> Add entry for master in hosts file of agent:
                <br>
                [root@agent ~]# vi /etc/hosts
                ip-address-master master.devops.org master
                </li>
                <li> Install puppet on agent:
                <br>
                [root@agent~]# yum -y install https://yum.puppetlabs.com/
                puppetlabs-release-pc1-el-7.noarch.rpm
                <br>
                [root@agent ~]# yum -y install puppet-agent
                </li>
                <li> Creating symbolic link to make puppet available on
                command line:
                <br>
                [root@agent ~]# ln -s /opt/puppetlabs/bin/puppet*
                /usr/local/bin/
                </li>
                <li> Enable and start puppet on agent node:
                <br>
                [root@client ~]# systemctl start puppet.service
                <br>
                [root@client ~]# systemctl enable puppet.service
                </li>
                </ol>
                <h4> Certificates </h4>
                <ol class="nested">
                <li> Certificate request from agent:
                <br>
                [root@agent ~]# puppet agent --test
                --ca_server=master.devops.org
                </li>
                <li> On the puppet master server view the certificates:
                <br>
                [root@master ~]# puppet cert list
                </li>
                <li> On the puppet master server sign the certificate from
                agent:
                <br>
                [root@master ~]# puppet cert sign agent.devops.org
                </li>
                </ol>
                <h4> Deploying website on agent </h4>
                <ol class="nested">
                <li> Create manifests for setting up apache server on agent:
                <br>
                Go to path "/etc/puppetlabs/code/environments/production/
                manifests" on master node and copy file
                <a href="https://gcallah.github.io/DevOps/deployment/puppetScripts/manifests/apache.pp">apache.pp</a>
                </li>
                <li> Create manifests for setting up git and continuous
                integration on agent:
                <br>
                Go to path "/etc/puppetlabs/code/environments/production/
                manifests" on master node and copy file
                <a href="https://gcallah.github.io/DevOps/deployment/puppetScripts/manifests/site.pp">site.pp</a>
                </li>
                <li> Install the puppet vcsrepo module for continuous 
                delivery on master node:
                <br>
                [root@master ~]# puppet module install puppetlabs-vcsrepo 
                --version 2.3.0
                </li>
                <li> Configure the time interval for continuous delivery:
                <br>
                Edit file "/etc/puppetlabs/puppet/puppet.conf" and add below
                lines of code on agent node -
                <br>
                server = master.devops.org
                <br>
                runinterval = 30
                </li>
                <li> Run the catalog to setup agent node:
                <br>
                [root@agent ~]# puppet agent --test
                --ca_server=master.devops.org
                </li>
                </ol>
                <p>
                After following the above steps, the website is deployed
                on agent node and can be accessed by using the agent ip
                address or dns name. It should open the deployed website as
                shown -
                </p>
                <figure>
                    <img src="https://gcallah.github.io/DevOps/deployment/graphics/websiteup.png" style="width:604px;height:442px;">
                </figure>
                <br>
                <p>
                If there are any new commits made on git the website will
                be continuously refreshed with the changes.
                </p>
                <h2>Run Deployment Automation</h2>
                <p> We have automated the above deployment steps for hosting
                the course website on Amazon Cloud.
                Steps to run:
                <ol class="nested">
                <li> Download <a href="https://github.com/gcallah/DevOps/tree/master/deployment/puppetScripts">
                puppetScripts folder </a> from git repository. 
                </li>
                <li>
                Go to the folder on your local machine.
                </li>
                <li>
                To install the required packages and configure AWS account run
                the following script:
                <b>./install.sh</b>
                </li>
                <li>
                Run the following command to start the deployment on Amazon
                AWS:
                <br>
                <b>python deploy.py</b>
                <br>
                <i>Note: There might be additional python packages not
                installed on your machine. Please make sure to install them if
                error prompts while running the deploy script.</i>
                </li>
                </ol>
                </p>
                <details>
                <summary class="sum2">
                    Sources
                </summary>
                <ol class="nested">
                <li><a href="https://rnelson0.com/2014/09/29/deploying-your-custom-application-with-puppet/">Deploying
                custom application using puppet
                </a>
                </li>
                <li><a href="https://computingforgeeks.com/working-with-puppet-4-on-rhel-7-and-centos-7/">Getting Started
                and Working with Puppet 4 On RHEL 7 and CentOS 7
                </a>
                </li>
                <li><a href="https://www.itzgeek.com/how-tos/linux/how-to-create-puppet-manifests-modules-on-centos-rhel.html">
                How to Create Puppet Manifests
                </a>
                </li>
                </ol>
                </details>
            </div>
        </div>

    </body>
</html>
